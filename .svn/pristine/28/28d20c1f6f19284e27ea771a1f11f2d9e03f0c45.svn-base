<!-- Project list -->
<div class="panel panel-flat">
    <div class = "row m-10">
        <a href="#">
            <button class = "btn bg-success btn-labeled" id = "add_risk"><b><i class="icon-plus2"></i></b>Add Issue/Risk</button>
        </a>
    </div>

    <div class="table-responsive">
        <table class="table text-nowrap datatable-issue-risk-list">
            <thead>
            <tr>
                <th>Project</th>
                <th>Issue Risk</th>
                <th>Type</th>
                <th>Raised Date</th>
                <th>Status</th>
                <th>Issue or Risk</th>
                <th style="width: 20px;"><i class="icon-arrow-down12"></i></th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

    </div>
</div>
<script type="text/javascript">
    $(function () {
        $('#add_risk').on('click', function() {
            var option = "";
            <?php foreach ($project as $key => $value) { ?>
            option += '<option value="<?php echo $value->id ?>"><?php echo $value->project_name ?></option>';
            <?php }?>
            bootbox.dialog({
                    title: "Add Issue/Risk",
                    message: '<div class="row"> ' +
                    '<div class="col-md-12">' +
                    '<form action="#" id = "add_risk_form">' +
                    '<div class="form-group">' +
                    '<div class="row">'+
                    '<div class="col-sm-12">' +
                    '<label>Issue/Risk Register No.</label> '+
                    '<input type="text" id = "potential_impact" name = "potential_impact" class="form-control"> '+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="form-group">' +
                    '<div class="row">'+
                    '<div class="col-sm-12">' +
                    '<label>Project</label> '+
                    '<select id="project_id" name="project_id" data-placeholder="Select project" class="select">'+
                    '<option value="">No Project</option>' +
                    option +
                    '</select>' +
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="form-group">' +
                    '<div class="row">'+
                    '<div class="col-sm-12">' +
                    '<label>Issue/Risk</label> '+
                    '<input type="text" class="form-control" name = "issue_risk" id = "issue_risk" value="">'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="form-group">' +
                    '<div class="row">'+
                    '<div class="col-sm-12">' +
                    '<label>Potential Impact</label> '+
                    '<input type="text" id = "potential_impact" name = "potential_impact" class="form-control"> '+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="form-group mt-10">' +
                    '<div class="row">'+
                    '<div class="col-sm-6">' +
                    '<label>Issue or Risk</label> '+
                    '<select id="issue_or_risk" name="issue_or_risk" data-placeholder="" class="select">'+
                    '<option value="issue">Issue</option>'+
                    '<option value="risk">Risk</option>'+
                    '</select>' +
                    '</div>'+
                    '<div class="col-sm-6">' +
                    '<label>Status</label> '+
                    '<select id="status" name="status" data-placeholder="" class="select">'+
                    '<option value="open">Open</option>'+
                    '<option value="closed" disabled>Closed</option>'+
                    '</select>' +
                    '</div> '+
                    '</div> '+
                    '</div> '+
                    '<div class="form-group mt-10">' +
                    '<div class="row">'+
                    '<div class="col-sm-6">' +
                    '<label>Level of Attention</label> '+
                    '<select id="issue_only" name="issue_only" data-placeholder="" class="select">'+
                    '<option value="Not Significant">Not Significant</option>'+
                    '<option value="Significant">Significant</option>'+
                    '<option value="Very Significant">Very Significant</option>'+
                    '</select>' +
                    '</div>'+
                    '<div class="col-sm-6">' +
                    '<label>Attach Supporting document</label> '+
                    '<input type="file" name="attach_doc" class="form-control">'+
                    '</div> '+
                    '</div> '+
                    '</div> '+
                    /*'<div class="form-group">' +
                    '<div class="row">'+
                    '<div class="col-sm-12">' +
                    '<label>Type of Risk/Issue</label> '+
                    '<input type="text" class="form-control" name = "tools_id" value="">'+
                    '<span class="help-block">Permit, Material, Financial, Document,  Delivery, Vendor Selection, Spec, Community, Manpower, etc.</span>' +
                    '</div>'+
                    '</div>'+
                    '</div>'+*/
                    '<ul class="nav nav-lg nav-tabs nav-tabs-bottom nav-tabs-toolbar no-margin">' +
                    '<li class="active"><a href="#a" data-toggle="tab" aria-expanded="true">Detail</a></li>' +
                    ' <li class="risk"><a href="#b" data-toggle="tab" aria-expanded="false">Risk</a></li>' +
                    ' <li class=""><a href="#c" data-toggle="tab" aria-expanded="false">Response</a></li>' +
                    '</ul>' +
                    '<div class="tab-content">' +
                    '<div class="tab-pane fade active in" id="a">' +
                    '<div class="form-group mt-10">' +
                    '<div class="row">'+
                    '<div class="col-sm-6">' +
                    '<label>Raised Date</label> '+
                    '<input type="text" id = "raised_date" name = "raised_date" class="form-control daterange-single"> '+
                    '</div>'+
                    '<div class="col-sm-6">' +
                    '</div> '+
                    '</div> '+
                    '</div> '+
                    '<div class="form-group">' +
                    '<div class="row">'+
                    '<div class="col-sm-6">' +
                    '</div>'+
                    '<div class="col-sm-6 issue">' +
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="tab-pane fade" id="b">' +
                    '<div class="form-group mt-10">' +
                    '<div class="row">'+
                    '<div class="col-sm-6">' +
                    '<label>Probability</label> '+
                    '<input type="text" id = "risk_only_probability" name = "risk_only_probability" class="form-control"> '+
                    '</div>'+
                    '<div class="col-sm-6">' +
                    '<label>Impact</label> '+
                    '<input type="text" id = "risk_only_impact" name = "risk_only_impact" class="form-control"> '+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="form-group">' +
                    '<div class="row">'+
                    '<div class="col-sm-12">' +
                    '<label>Significance</label> '+
                    '<input type="text" id = "risk_only_significance" name = "risk_only_significance" class="form-control"> '+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="tab-pane fade" id="c">' +
                    '<div class="form-group mt-10">' +
                    '<div class="row">'+
                    '<div class="col-sm-6">' +
                    '<label>Current Response (mention date)</label> '+
                    '<input type="text" id = "current_response" name = "current_response" class="form-control"> '+
                    '</div>'+
                    '<div class="col-sm-6">' +
                    '<label>Current Response Date</label> '+
                    '<input type="text" id = "current_response_date" name = "current_response_date" class="form-control daterange-single"> '+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="form-group">' +
                    '<div class="row">'+
                    '<div class="col-sm-6">' +
                    '<label>Further Action (mention date)</label> '+
                    '<input type="text" id = "further_action" name = "further_action" class="form-control"> '+
                    '</div>'+
                    '<div class="col-sm-6">' +
                    '<label>Further Action Date</label> '+
                    '<input type="text" id = "further_action_date" name = "further_action_date" class="form-control daterange-single"> '+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</div>'+
                    '</form>' +
                    '</div>' +
                    '</div>',
                    buttons: {
                        success: {
                            label: "Save",
                            className: "btn-success",
                            callback: function () {
                                var form = $('#add_risk_form');
                                $.ajax({
                                    url:  JS_BASE_URL +'/issueRisk/create/',
                                    type : 'POST',
                                    dataType: 'json',
                                    data: form.serialize(),
                                    success: function(res) {
                                        var dbmil = $('.datatable-issue-risk-list').dataTable();
                                        if(res.status == 'Success'){
                                            alertSuccess();
                                            dbmil.api().ajax.reload();
                                        }
                                    }
                                });
                            }
                        }
                    }
                }
            );
            $('.risk').hide();
            $( "#issue_or_risk" ).change(function() {
                console.log($(this).val());
                if($(this).val() === 'risk'){
                    $('.risk').fadeIn(300);
                    $('.issue').fadeOut(300);
                } else {
                    $('.risk').fadeOut(300);
                    $('.issue').fadeIn(300);
                }
            });
            $('.select').parents('.bootbox').removeAttr('tabindex');
            $('.select').select2();

            $('.daterange-single').daterangepicker({
                singleDatePicker: true,
                locale: {
                    format: 'DD-MM-YYYY'
                },
            });
        });


    });
</script>


